ïÊ
PD:\GitProjects\BookMyShow\payment\imintsettlement\clsimintSettlementProcessor.cs
internal 
static	 
class '
clsimintSettlementProcessor 1
{ 
const 	
string
 
udcErrorSource 
=  !
$str" ?
;? @
static		 

string		 
	strFolder		 
=		 
System		 $
.		$ %
	AppDomain		% .
.		. /
CurrentDomain		/ <
.		< =
BaseDirectory		= J
+		K L
$str		M b
;		b c
internal 
static 
bool *
blnGenerateimintSettlementFile 7
(7 8
out8 ;
long< @
lngimintUpdateStampA T
)T U
{ 
const 
string 
udcErrorMethod #
=$ %
$str& F
;F G
string 
udcMerchantId 
= 
clsSettings *
.* +
Get+ .
(. /
$str/ 6
,6 7
$str8 D
,D E
$strF P
)P Q
;Q R
string 
udcTerminalId 
= 
clsSettings *
.* +
Get+ .
(. /
$str/ 6
,6 7
$str8 D
,D E
$strF P
)P Q
;Q R
const 
string 
udcActionCode "
=# $
$str% +
;+ ,
const 
string 
udcPaymentType #
=$ %
$str& ,
;, -
const 
string 
udcUnits 
= 
$str  (
;( )
const 
string 
udcHasSKUActivity &
=' (
$str) ,
;, -
lngimintUpdateStamp 
= 
$num 
;  
try 
{ 	
if 
( 
System 
. 
IO 
. 
	Directory #
.# $
Exists$ *
(* +
	strFolder+ 4
)4 5
==6 8
false9 >
)> ?
{ 
System 
. 
IO 
. 
	Directory #
.# $
CreateDirectory$ 3
(3 4
	strFolder4 =
)= >
;> ?
} 
} 	
catch   
(   
	Exception   
ex   
)   
{!! 	
clsLog"" 
."" 
blnLogError"" 
("" 
udcErrorSource"" -
,""- .
udcErrorMethod""/ =
,""= >
$str""? b
+""c d
	strFolder""e n
,""n o
ex""p r
.""r s
ToString""s {
(""{ |
)""| }
)""} ~
;""~ 
return## 
false## 
;## 
}$$ 	
string&& 
strFileName&& 
=&& 
$str&& 
,&&  
strSettlementDate&&! 2
=&&3 4
$str&&5 7
;&&7 8
	ArrayList'' 
arlSettlement'' 
=''  !
new''" %
	ArrayList''& /
(''/ 0
)''0 1
;''1 2
	ArrayList(( 
arlPaymentId(( 
=((  
new((! $
	ArrayList((% .
(((. /
)((/ 0
;((0 1
clsDBEngine)) 
objDB)) 
=)) 
new)) 
clsDBEngine))  +
())+ ,
))), -
;))- .
StreamWriter** 
stwSettlement** "
;**" #
System++ 
.++ 
Text++ 
.++ 
StringBuilder++ !
sbrData++" )
;++) *
string,, 
strSQL,, 
=,, 
$str,, 3
;,,3 4
if.. 

(.. 
objDB.. 
... 
blnOpenResultSet.. "
(.." #
strSQL..# )
)..) *
==..+ -
true... 2
)..2 3
{// 	
if00 
(00 
objDB00 
.00 
blnHasRecords00 #
==00$ &
true00' +
)00+ ,
{11 
strSettlementDate22 !
=22" #
DateTime22$ ,
.22, -
Now22- 0
.220 1
ToString221 9
(229 :
$str22: D
)22D E
;22E F
}33 
while55 
(55 
objDB55 
.55 !
blnResultsMoveNextRow55 .
(55. /
)55/ 0
==551 3
true554 8
)558 9
{66 
if88 
(88 
objDB88 
.88 
objResultsValue88 )
(88) *
$str88* <
)88< =
.88= >
ToString88> F
(88F G
)88G H
==88I K
$str88L S
)88S T
{99 
sbrData:: 
=:: 
new:: !
System::" (
.::( )
Text::) -
.::- .
StringBuilder::. ;
(::; <
)::< =
;::= >
sbrData;; 
.;; 
Append;; "
(;;" #
objDB;;# (
.;;( )
objResultsValue;;) 8
(;;8 9
$str;;9 I
);;I J
.;;J K
ToString;;K S
(;;S T
);;T U
+;;V W
$str;;X [
);;[ \
;;;\ ]
sbrData<< 
.<< 
Append<< "
(<<" #
$str<<# (
)<<( )
;<<) *
sbrData== 
.== 
Append== "
(==" #
udcMerchantId==# 0
+==1 2
$str==3 6
)==6 7
;==7 8
sbrData>> 
.>> 
Append>> "
(>>" #
$str>># &
)>>& '
;>>' (
sbrData?? 
.?? 
Append?? "
(??" #
udcTerminalId??# 0
+??1 2
$str??3 6
)??6 7
;??7 8
sbrData@@ 
.@@ 
Append@@ "
(@@" #
$str@@# &
)@@& '
;@@' (
sbrDataAA 
.AA 
AppendAA "
(AA" #
(AA# $
objDBAA$ )
.AA) *
objResultsValueAA* 9
(AA9 :
$strAA: G
)AAG H
.AAH I
ToStringAAI Q
(AAQ R
)AAR S
+AAT U
$strAAV Y
)AAY Z
)AAZ [
;AA[ \
sbrDataBB 
.BB 
AppendBB "
(BB" #
$strBB# '
)BB' (
;BB( )
sbrDataCC 
.CC 
AppendCC "
(CC" #
udcActionCodeCC# 0
+CC1 2
$strCC3 6
)CC6 7
;CC7 8
sbrDataEE 
.EE 
AppendEE "
(EE" #
objDBEE# (
.EE( )
objResultsValueEE) 8
(EE8 9
$strEE9 R
)EER S
.EES T
ToStringEET \
(EE\ ]
)EE] ^
+EE_ `
$strEEa d
)EEd e
;EEe f
sbrDataFF 
.FF 
AppendFF "
(FF" #
$strFF# '
)FF' (
;FF( )
sbrDataGG 
.GG 
AppendGG "
(GG" #
udcPaymentTypeGG# 1
+GG2 3
$strGG4 7
)GG7 8
;GG8 9
sbrDataHH 
.HH 
AppendHH "
(HH" #
objDBHH# (
.HH( )
objResultsValueHH) 8
(HH8 9
$strHH9 H
)HHH I
.HHI J
ToStringHHJ R
(HHR S
)HHS T
+HHU V
$strHHW Z
)HHZ [
;HH[ \
sbrDataII 
.II 
AppendII "
(II" #
$strII# &
)II& '
;II' (
sbrDataJJ 
.JJ 
AppendJJ "
(JJ" #
floatJJ# (
.JJ( )
ParseJJ) .
(JJ. /
objDBJJ/ 4
.JJ4 5
objResultsValueJJ5 D
(JJD E
$strJJE U
)JJU V
.JJV W
ToStringJJW _
(JJ_ `
)JJ` a
)JJa b
.JJb c
ToStringJJc k
(JJk l
$strJJl o
)JJo p
+JJq r
$strJJs v
)JJv w
;JJw x
sbrDataKK 
.KK 
AppendKK "
(KK" #
udcUnitsKK# +
+KK, -
$strKK. 1
)KK1 2
;KK2 3
sbrDataLL 
.LL 
AppendLL "
(LL" #
$strLL# '
)LL' (
;LL( )
sbrDataMM 
.MM 
AppendMM "
(MM" #
udcHasSKUActivityMM# 4
+MM5 6
$strMM7 :
)MM: ;
;MM; <
sbrDataNN 
.NN 
AppendNN "
(NN" #
strSettlementDateNN# 4
+NN5 6
$strNN7 :
)NN: ;
;NN; <
sbrDataOO 
.OO 
AppendOO "
(OO" #
(OO# $
objDBOO$ )
.OO) *
objResultsValueOO* 9
(OO9 :
$strOO: G
)OOG H
.OOH I
ToStringOOI Q
(OOQ R
)OOR S
+OOT U
$strOOV Y
)OOY Z
)OOZ [
;OO[ \
sbrDataPP 
.PP 
AppendPP "
(PP" #
$strPP# (
)PP( )
;PP) *
sbrDataQQ 
.QQ 
AppendQQ "
(QQ" #
(QQ# $
objDBQQ$ )
.QQ) *
objResultsValueQQ* 9
(QQ9 :
$strQQ: G
)QQG H
.QQH I
ToStringQQI Q
(QQQ R
)QQR S
+QQT U
$strQQV Y
)QQY Z
)QQZ [
;QQ[ \
sbrDataRR 
.RR 
AppendRR "
(RR" #
$strRR# -
)RR- .
;RR. /
arlSettlementSS !
.SS! "
AddSS" %
(SS% &
sbrDataSS& -
)SS- .
;SS. /
}TT 
elseVV 
ifVV 
(VV 
objDBVV 
.VV 
objResultsValueVV .
(VV. /
$strVV/ A
)VVA B
.VVB C
ToStringVVC K
(VVK L
)VVL M
==VVN P
$strVVQ Y
)VVY Z
{WW 
sbrDataZZ 
=ZZ 
newZZ !
SystemZZ" (
.ZZ( )
TextZZ) -
.ZZ- .
StringBuilderZZ. ;
(ZZ; <
)ZZ< =
;ZZ= >
sbrData[[ 
.[[ 
Append[[ "
([[" #
objDB[[# (
.[[( )
objResultsValue[[) 8
([[8 9
$str[[9 I
)[[I J
.[[J K
ToString[[K S
([[S T
)[[T U
+[[V W
$str[[X [
)[[[ \
;[[\ ]
sbrData\\ 
.\\ 
Append\\ "
(\\" #
$str\\# (
)\\( )
;\\) *
sbrData]] 
.]] 
Append]] "
(]]" #
udcMerchantId]]# 0
+]]1 2
$str]]3 6
)]]6 7
;]]7 8
sbrData^^ 
.^^ 
Append^^ "
(^^" #
$str^^# &
)^^& '
;^^' (
sbrData__ 
.__ 
Append__ "
(__" #
udcTerminalId__# 0
+__1 2
$str__3 6
)__6 7
;__7 8
sbrData`` 
.`` 
Append`` "
(``" #
$str``# &
)``& '
;``' (
sbrDataaa 
.aa 
Appendaa "
(aa" #
(aa# $
objDBaa$ )
.aa) *
objResultsValueaa* 9
(aa9 :
$straa: G
)aaG H
.aaH I
ToStringaaI Q
(aaQ R
)aaR S
+aaT U
$straaV Y
)aaY Z
)aaZ [
;aa[ \
sbrDatabb 
.bb 
Appendbb "
(bb" #
$strbb# '
)bb' (
;bb( )
sbrDatacc 
.cc 
Appendcc "
(cc" #
udcActionCodecc# 0
+cc1 2
$strcc3 6
)cc6 7
;cc7 8
sbrDatadd 
.dd 
Appenddd "
(dd" #
objDBdd# (
.dd( )
objResultsValuedd) 8
(dd8 9
$strdd9 R
)ddR S
.ddS T
ToStringddT \
(dd\ ]
)dd] ^
+dd_ `
$strdda d
)ddd e
;dde f
sbrDataee 
.ee 
Appendee "
(ee" #
$stree# '
)ee' (
;ee( )
sbrDataff 
.ff 
Appendff "
(ff" #
udcPaymentTypeff# 1
+ff2 3
$strff4 7
)ff7 8
;ff8 9
sbrDatagg 
.gg 
Appendgg "
(gg" #
objDBgg# (
.gg( )
objResultsValuegg) 8
(gg8 9
$strgg9 H
)ggH I
.ggI J
ToStringggJ R
(ggR S
)ggS T
+ggU V
$strggW Z
)ggZ [
;gg[ \
sbrDatahh 
.hh 
Appendhh "
(hh" #
$strhh# &
)hh& '
;hh' (
sbrDataii 
.ii 
Appendii "
(ii" #
floatii# (
.ii( )
Parseii) .
(ii. /
objDBii/ 4
.ii4 5
objResultsValueii5 D
(iiD E
$striiE U
)iiU V
.iiV W
ToStringiiW _
(ii_ `
)ii` a
)iia b
.iib c
ToStringiic k
(iik l
$striil o
)iio p
+iiq r
$striis v
)iiv w
;iiw x
sbrDatajj 
.jj 
Appendjj "
(jj" #
udcUnitsjj# +
+jj, -
$strjj. 1
)jj1 2
;jj2 3
sbrDatakk 
.kk 
Appendkk "
(kk" #
$strkk# '
)kk' (
;kk( )
sbrDatall 
.ll 
Appendll "
(ll" #
udcHasSKUActivityll# 4
+ll5 6
$strll7 :
)ll: ;
;ll; <
sbrDatamm 
.mm 
Appendmm "
(mm" #
strSettlementDatemm# 4
+mm5 6
$strmm7 :
)mm: ;
;mm; <
sbrDatann 
.nn 
Appendnn "
(nn" #
(nn# $
objDBnn$ )
.nn) *
objResultsValuenn* 9
(nn9 :
$strnn: G
)nnG H
.nnH I
ToStringnnI Q
(nnQ R
)nnR S
+nnS T
$strnnT j
)nnj k
)nnk l
;nnl m
sbrDataoo 
.oo 
Appendoo "
(oo" #
$stroo# (
)oo( )
;oo) *
sbrDatapp 
.pp 
Appendpp "
(pp" #
(pp# $
objDBpp$ )
.pp) *
objResultsValuepp* 9
(pp9 :
$strpp: G
)ppG H
.ppH I
ToStringppI Q
(ppQ R
)ppR S
+ppS T
$strppT W
)ppW X
)ppX Y
;ppY Z
sbrDataqq 
.qq 
Appendqq "
(qq" #
$strqq# -
)qq- .
;qq. /
arlSettlementrr !
.rr! "
Addrr" %
(rr% &
sbrDatarr& -
)rr- .
;rr. /
sbrDataww 
=ww 
newww !
Systemww" (
.ww( )
Textww) -
.ww- .
StringBuilderww. ;
(ww; <
)ww< =
;ww= >
sbrDataxx 
.xx 
Appendxx "
(xx" #
objDBxx# (
.xx( )
objResultsValuexx) 8
(xx8 9
$strxx9 I
)xxI J
.xxJ K
ToStringxxK S
(xxS T
)xxT U
+xxV W
$strxxX [
)xx[ \
;xx\ ]
sbrDatayy 
.yy 
Appendyy "
(yy" #
$stryy# (
)yy( )
;yy) *
sbrDatazz 
.zz 
Appendzz "
(zz" #
udcMerchantIdzz# 0
+zz1 2
$strzz3 6
)zz6 7
;zz7 8
sbrData{{ 
.{{ 
Append{{ "
({{" #
$str{{# &
){{& '
;{{' (
sbrData|| 
.|| 
Append|| "
(||" #
udcTerminalId||# 0
+||1 2
$str||3 6
)||6 7
;||7 8
sbrData}} 
.}} 
Append}} "
(}}" #
$str}}# &
)}}& '
;}}' (
sbrData~~ 
.~~ 
Append~~ "
(~~" #
(~~# $
objDB~~$ )
.~~) *
objResultsValue~~* 9
(~~9 :
$str~~: G
)~~G H
.~~H I
ToString~~I Q
(~~Q R
)~~R S
+~~T U
$str~~V Y
)~~Y Z
)~~Z [
;~~[ \
sbrData 
. 
Append "
(" #
$str# '
)' (
;( )
sbrData
ÄÄ 
.
ÄÄ 
Append
ÄÄ "
(
ÄÄ" #
udcActionCode
ÄÄ# 0
+
ÄÄ1 2
$str
ÄÄ3 6
)
ÄÄ6 7
;
ÄÄ7 8
sbrData
ÇÇ 
.
ÇÇ 
Append
ÇÇ "
(
ÇÇ" #
$str
ÇÇ# 2
)
ÇÇ2 3
;
ÇÇ3 4
sbrData
ÑÑ 
.
ÑÑ 
Append
ÑÑ "
(
ÑÑ" #
$str
ÑÑ# '
)
ÑÑ' (
;
ÑÑ( )
sbrData
ÖÖ 
.
ÖÖ 
Append
ÖÖ "
(
ÖÖ" #
udcPaymentType
ÖÖ# 1
+
ÖÖ2 3
$str
ÖÖ4 7
)
ÖÖ7 8
;
ÖÖ8 9
sbrData
ÜÜ 
.
ÜÜ 
Append
ÜÜ "
(
ÜÜ" #
objDB
ÜÜ# (
.
ÜÜ( )
objResultsValue
ÜÜ) 8
(
ÜÜ8 9
$str
ÜÜ9 H
)
ÜÜH I
.
ÜÜI J
ToString
ÜÜJ R
(
ÜÜR S
)
ÜÜS T
+
ÜÜU V
$str
ÜÜW Z
)
ÜÜZ [
;
ÜÜ[ \
sbrData
áá 
.
áá 
Append
áá "
(
áá" #
$str
áá# &
)
áá& '
;
áá' (
sbrData
àà 
.
àà 
Append
àà "
(
àà" #
float
àà# (
.
àà( )
Parse
àà) .
(
àà. /
objDB
àà/ 4
.
àà4 5
objResultsValue
àà5 D
(
ààD E
$str
ààE U
)
ààU V
.
ààV W
ToString
ààW _
(
àà_ `
)
àà` a
)
ààa b
.
ààb c
ToString
ààc k
(
ààk l
$str
ààl o
)
àào p
+
ààq r
$str
ààs v
)
ààv w
;
ààw x
sbrData
ââ 
.
ââ 
Append
ââ "
(
ââ" #
udcUnits
ââ# +
+
ââ, -
$str
ââ. 1
)
ââ1 2
;
ââ2 3
sbrData
ää 
.
ää 
Append
ää "
(
ää" #
$str
ää# '
)
ää' (
;
ää( )
sbrData
ãã 
.
ãã 
Append
ãã "
(
ãã" #
udcHasSKUActivity
ãã# 4
+
ãã5 6
$str
ãã7 :
)
ãã: ;
;
ãã; <
sbrData
åå 
.
åå 
Append
åå "
(
åå" #
strSettlementDate
åå# 4
+
åå5 6
$str
åå7 :
)
åå: ;
;
åå; <
sbrData
éé 
.
éé 
Append
éé "
(
éé" #
(
éé# $
objDB
éé$ )
.
éé) *
objResultsValue
éé* 9
(
éé9 :
$str
éé: G
)
ééG H
.
ééH I
ToString
ééI Q
(
ééQ R
)
ééR S
+
ééT U
$str
ééV m
)
éém n
)
één o
;
ééo p
sbrData
èè 
.
èè 
Append
èè "
(
èè" #
$str
èè# (
)
èè( )
;
èè) *
sbrData
êê 
.
êê 
Append
êê "
(
êê" #
(
êê# $
objDB
êê$ )
.
êê) *
objResultsValue
êê* 9
(
êê9 :
$str
êê: G
)
êêG H
.
êêH I
ToString
êêI Q
(
êêQ R
)
êêR S
+
êêT U
$str
êêV Y
)
êêY Z
)
êêZ [
;
êê[ \
sbrData
ëë 
.
ëë 
Append
ëë "
(
ëë" #
$str
ëë# -
)
ëë- .
;
ëë. /
arlSettlement
íí !
.
íí! "
Add
íí" %
(
íí% &
sbrData
íí& -
)
íí- .
;
íí. /
}
ìì 
}
ññ 
objDB
òò 
.
òò "
blnMoveNextResultSet
òò &
(
òò& '
)
òò' (
;
òò( )
objDB
öö 
.
öö #
blnResultsMoveNextRow
öö '
(
öö' (
)
öö( )
;
öö) *!
lngimintUpdateStamp
úú 
=
úú  !
long
úú" &
.
úú& '
Parse
úú' ,
(
úú, -
objDB
úú- 2
.
úú2 3
objResultsValue
úú3 B
(
úúB C
$str
úúC Y
)
úúY Z
.
úúZ [
ToString
úú[ c
(
úúc d
)
úúd e
)
úúe f
;
úúf g
if
ûû 
(
ûû 
strSettlementDate
ûû !
.
ûû! "
Length
ûû" (
>
ûû) *
$num
ûû+ ,
)
ûû, -
{
üü 
strFileName
†† 
=
†† 
	strFolder
†† '
+
††( )
$str
††* C
+
††D E
strSettlementDate
††F W
+
††X Y
$str
††Z `
;
††` a
}
°° 
}
¢¢ 	
else
££ 
{
§§ 	
objDB
•• 
.
••  
blnCloseConnection
•• $
(
••$ %
)
••% &
;
••& '
clsLog
¶¶ 
.
¶¶ 
blnLogError
¶¶ 
(
¶¶ 
udcErrorSource
¶¶ -
,
¶¶- .
udcErrorMethod
¶¶/ =
,
¶¶= >
$str
¶¶? m
,
¶¶m n
objDB
¶¶o t
.
¶¶t u
strErrorMessage¶¶u Ñ
)¶¶Ñ Ö
;¶¶Ö Ü
return
ßß 
false
ßß 
;
ßß 
}
®® 	
objDB
™™ 
.
™™  
blnCloseConnection
™™  
(
™™  !
)
™™! "
;
™™" #
if
¨¨ 

(
¨¨ 
strFileName
¨¨ 
.
¨¨ 
Length
¨¨ 
>
¨¨  
$num
¨¨! "
)
¨¨" #
{
≠≠ 	
try
ÆÆ 
{
ØØ 
stwSettlement
∞∞ 
=
∞∞ 
new
∞∞  #
StreamWriter
∞∞$ 0
(
∞∞0 1
strFileName
∞∞1 <
,
∞∞< =
false
∞∞> C
)
∞∞C D
;
∞∞D E
for
≤≤ 
(
≤≤ 
int
≤≤ 
intCount
≤≤ !
=
≤≤" #
$num
≤≤$ %
;
≤≤% &
intCount
≤≤' /
<
≤≤0 1
arlSettlement
≤≤2 ?
.
≤≤? @
Count
≤≤@ E
;
≤≤E F
intCount
≤≤G O
++
≤≤O Q
)
≤≤Q R
{
≥≥ 
stwSettlement
¥¥ !
.
¥¥! "
	WriteLine
¥¥" +
(
¥¥+ ,
arlSettlement
¥¥, 9
[
¥¥9 :
intCount
¥¥: B
]
¥¥B C
.
¥¥C D
ToString
¥¥D L
(
¥¥L M
)
¥¥M N
)
¥¥N O
;
¥¥O P
}
µµ 
stwSettlement
∂∂ 
.
∂∂ 
Close
∂∂ #
(
∂∂# $
)
∂∂$ %
;
∂∂% &
stwSettlement
∑∑ 
=
∑∑ 
null
∑∑  $
;
∑∑$ %
}
∏∏ 
catch
ππ 
(
ππ 
	Exception
ππ 
ex
ππ 
)
ππ  
{
∫∫ 
stwSettlement
ªª 
=
ªª 
null
ªª  $
;
ªª$ %
clsLog
ºº 
.
ºº 
blnLogError
ºº "
(
ºº" #
udcErrorSource
ºº# 1
,
ºº1 2
udcErrorMethod
ºº3 A
,
ººA B
$str
ººC i
,
ººi j
ex
ººk m
.
ººm n
ToString
ººn v
(
ººv w
)
ººw x
)
ººx y
;
ººy z
return
ΩΩ 
false
ΩΩ 
;
ΩΩ 
}
ææ 
}
øø 	
return
¡¡ 
true
¡¡ 
;
¡¡ 
}
¬¬ 
internal
ƒƒ 
static
ƒƒ 
bool
ƒƒ (
blnMailimintSettlementFile
ƒƒ 3
(
ƒƒ3 4
string
ƒƒ4 :
strFileName
ƒƒ; F
,
ƒƒF G
string
ƒƒH N
strFilePath
ƒƒO Z
,
ƒƒZ [
string
ƒƒ\ b
strFileType
ƒƒc n
)
ƒƒn o
{
≈≈ 
const
∆∆ 
string
∆∆ 
udcErrorMethod
∆∆ #
=
∆∆$ %
$str
∆∆& B
;
∆∆B C
string
»» 
strEmailList
»» 
=
»» 
$str
»»  
,
»»  !
strEmailListCC
»»" 0
=
»»1 2
$str
»»3 5
;
»»5 6
bool
…… 
	blnReturn
…… 
=
…… 
false
…… 
;
…… 
try
ÀÀ 
{
ÃÃ 	
clsMail
ÕÕ 
objMail
ÕÕ 
=
ÕÕ 
new
ÕÕ !
clsMail
ÕÕ" )
(
ÕÕ) *
)
ÕÕ* +
;
ÕÕ+ ,
if
ŒŒ 
(
ŒŒ 
strFileType
ŒŒ 
==
ŒŒ 
$str
ŒŒ "
)
ŒŒ" #
{
œœ 
strEmailList
–– 
=
–– 
clsSettings
–– *
.
––* +
Get
––+ .
(
––. /
$str
––/ 6
,
––6 7
$str
––8 C
,
––C D
$str
––E G
)
––G H
;
––H I
strEmailListCC
—— 
=
——  
clsSettings
——! ,
.
——, -
Get
——- 0
(
——0 1
$str
——1 8
,
——8 9
$str
——: G
,
——G H
$str
——I K
)
——K L
;
——L M
}
““ 
else
”” 
if
”” 
(
”” 
strFileType
””  
==
””! #
$str
””$ '
)
””' (
{
‘‘ 
strEmailList
’’ 
=
’’ 
clsSettings
’’ *
.
’’* +
Get
’’+ .
(
’’. /
$str
’’/ 6
,
’’6 7
$str
’’8 I
,
’’I J
$str
’’K M
)
’’M N
;
’’N O
strEmailListCC
÷÷ 
=
÷÷  
clsSettings
÷÷! ,
.
÷÷, -
Get
÷÷- 0
(
÷÷0 1
$str
÷÷1 8
,
÷÷8 9
$str
÷÷: M
,
÷÷M N
$str
÷÷O Q
)
÷÷Q R
;
÷÷R S
}
◊◊ 
foreach
ŸŸ 
(
ŸŸ 
string
ŸŸ 

strEmailId
ŸŸ &
in
ŸŸ' )
strEmailList
ŸŸ* 6
.
ŸŸ6 7
Split
ŸŸ7 <
(
ŸŸ< =
new
ŸŸ= @
char
ŸŸA E
[
ŸŸE F
]
ŸŸF G
{
ŸŸH I
$char
ŸŸJ M
}
ŸŸN O
)
ŸŸO P
)
ŸŸP Q
{
⁄⁄ 
if
€€ 
(
€€ 

strEmailId
€€ 
.
€€ 
Length
€€ %
>
€€& '
$num
€€( )
)
€€) *
{
‹‹ 
objMail
›› 
.
›› 
blnAddTo
›› $
(
››$ %
$str
››% 2
,
››2 3

strEmailId
››4 >
)
››> ?
;
››? @
}
ﬁﬁ 
}
ﬂﬂ 
foreach
·· 
(
·· 
string
·· 
strEmailIdCC
·· (
in
··) +
strEmailListCC
··, :
.
··: ;
Split
··; @
(
··@ A
new
··A D
char
··E I
[
··I J
]
··J K
{
··L M
$char
··N Q
}
··R S
)
··S T
)
··T U
{
‚‚ 
if
„„ 
(
„„ 
strEmailIdCC
„„  
.
„„  !
Length
„„! '
>
„„( )
$num
„„* +
)
„„+ ,
{
‰‰ 
objMail
ÂÂ 
.
ÂÂ 
blnAddTo
ÂÂ $
(
ÂÂ$ %
$str
ÂÂ% ,
,
ÂÂ, -
strEmailIdCC
ÂÂ. :
)
ÂÂ: ;
;
ÂÂ; <
}
ÊÊ 
}
ÁÁ 
objMail
ÈÈ 
.
ÈÈ 

blnAddFrom
ÈÈ 
(
ÈÈ 
$str
ÈÈ +
,
ÈÈ+ ,
$str
ÈÈ- E
)
ÈÈE F
;
ÈÈF G
objMail
ÍÍ 
.
ÍÍ 
MailPriority
ÍÍ  
=
ÍÍ! "
System
ÍÍ# )
.
ÍÍ) *
Net
ÍÍ* -
.
ÍÍ- .
Mail
ÍÍ. 2
.
ÍÍ2 3
MailPriority
ÍÍ3 ?
.
ÍÍ? @
High
ÍÍ@ D
;
ÍÍD E
objMail
ÎÎ 
.
ÎÎ 
blnAddAttachment
ÎÎ $
(
ÎÎ$ %
strFilePath
ÎÎ% 0
)
ÎÎ0 1
;
ÎÎ1 2
	blnReturn
ÏÏ 
=
ÏÏ 
objMail
ÏÏ 
.
ÏÏ  
blnSendMail
ÏÏ  +
(
ÏÏ+ ,
strFileName
ÏÏ, 7
,
ÏÏ7 8
strFileName
ÏÏ9 D
)
ÏÏD E
;
ÏÏE F
objMail
ÌÌ 
=
ÌÌ 
null
ÌÌ 
;
ÌÌ 
}
ÓÓ 	
catch
ÔÔ 
(
ÔÔ 
	Exception
ÔÔ 
ex
ÔÔ 
)
ÔÔ 
{
 	
	blnReturn
ÒÒ 
=
ÒÒ 
false
ÒÒ 
;
ÒÒ 
clsLog
ÚÚ 
.
ÚÚ 
blnLogError
ÚÚ 
(
ÚÚ 
udcErrorSource
ÚÚ -
,
ÚÚ- .
udcErrorMethod
ÚÚ/ =
,
ÚÚ= >
$str
ÚÚ? g
+
ÚÚh i
strFileName
ÚÚj u
,
ÚÚu v
ex
ÚÚw y
.
ÚÚy z
ToStringÚÚz Ç
(ÚÚÇ É
)ÚÚÉ Ñ
)ÚÚÑ Ö
;ÚÚÖ Ü
}
ÛÛ 	
return
ÙÙ 
	blnReturn
ÙÙ 
;
ÙÙ 
}
ıı 
}ˆˆ À-
<D:\GitProjects\BookMyShow\payment\imintsettlement\Program.cs
class 
Program 
{ 
const 	
string
 
udcErrorSource 
=  !
$str" +
;+ ,
static

 

void

 
Main

 
(

 
string

 
[

 
]

 
args

 "
)

" #
{ 
const 
string 
udcErrorMethod #
=$ %
$str& ,
;, -
bool 
blnMailFiles 
= 
true  
;  !
string 
strFileType 
= 
$str  
;  !
try 
{ 	
long 
lngimintUpdateStamp $
=% &
$num' (
;( )
if 
( '
clsimintSettlementProcessor +
.+ ,*
blnGenerateimintSettlementFile, J
(J K
outK N
lngimintUpdateStampO b
)b c
==d f
trueg k
)k l
{ 
clsDBEngine 
objDB !
=" #
new$ '
clsDBEngine( 3
(3 4
)4 5
;5 6
string 
strSQL 
= 
$str  K
+L M
lngimintUpdateStampN a
.a b
ToStringb j
(j k
)k l
+m n
$str	o £
;
£ §
if 
( 
objDB 
. 

blnExecute $
($ %
strSQL% +
)+ ,
==- /
false0 5
)5 6
{ 
clsLog 
. 
blnLogError &
(& '
udcErrorSource' 5
,5 6
udcErrorMethod7 E
,E F
$strG i
+j k
lngimintUpdateStampl 
.	 Ä
ToString
Ä à
(
à â
)
â ä
,
ä ã
objDB
å ë
.
ë í
strErrorMessage
í °
,
° ¢
false
£ ®
)
® ©
;
© ™
} 
objDB 
. 
blnCloseConnection (
(( )
)) *
;* +
} 
string!! 
strDirectoryPath!! #
=!!$ %
System!!& ,
.!!, -
	AppDomain!!- 6
.!!6 7
CurrentDomain!!7 D
.!!D E
BaseDirectory!!E R
+!!S T
$str!!U j
;!!j k
string"" "
strRefundDirectoryPath"" )
=""* +
System"", 2
.""2 3
	AppDomain""3 <
.""< =
CurrentDomain""= J
.""J K
BaseDirectory""K X
+""Y Z
$str""[ l
;""l m
string## 
strDestinationPath## %
=##& '
System##( .
.##. /
	AppDomain##/ 8
.##8 9
CurrentDomain##9 F
.##F G
BaseDirectory##G T
+##U V
$str##W f
;##f g
while%% 
(%% 
blnMailFiles%% 
==%%  "
true%%# '
)%%' (
{&& 
DirectoryInfo'' 
objDir'' $
=''% &
new''' *
DirectoryInfo''+ 8
(''8 9
strDirectoryPath''9 I
)''I J
;''J K
FileInfo(( 
[(( 
](( 
objFileInfo(( &
=((' (
objDir(() /
.((/ 0
GetFiles((0 8
(((8 9
)((9 :
;((: ;
for** 
(** 
int** 
intCount** !
=**" #
$num**$ %
;**% &
intCount**' /
<**0 1
objFileInfo**2 =
.**= >
Length**> D
;**D E
intCount**F N
++**N P
)**P Q
{++ 
if,, 
(,, '
clsimintSettlementProcessor,, 3
.,,3 4&
blnMailimintSettlementFile,,4 N
(,,N O
objFileInfo,,O Z
[,,Z [
intCount,,[ c
],,c d
.,,d e
Name,,e i
,,,i j
objFileInfo,,k v
[,,v w
intCount,,w 
]	,, Ä
.
,,Ä Å
FullName
,,Å â
,
,,â ä
strFileType
,,ã ñ
)
,,ñ ó
==
,,ò ö
true
,,õ ü
)
,,ü †
{-- 
objFileInfo.. #
[..# $
intCount..$ ,
].., -
...- .
MoveTo... 4
(..4 5
strDestinationPath..5 G
+..H I
objFileInfo..J U
[..U V
intCount..V ^
]..^ _
..._ `
Name..` d
)..d e
;..e f
}// 
}00 
if22 
(22 
strDirectoryPath22 $
!=22% '"
strRefundDirectoryPath22( >
)22> ?
{33 
strDirectoryPath44 $
=44% &"
strRefundDirectoryPath44' =
;44= >
strFileType55 
=55  !
$str55" %
;55% &
}66 
else77 
{88 
blnMailFiles99  
=99! "
false99# (
;99( )
}:: 
objFileInfo<< 
=<< 
null<< "
;<<" #
objDir== 
=== 
null== 
;== 
}>> 
}?? 	
catch@@ 
(@@ 
	Exception@@ 
ex@@ 
)@@ 
{AA 	
clsLogBB 
.BB 
blnLogErrorBB 
(BB 
udcErrorSourceBB -
,BB- .
udcErrorMethodBB/ =
,BB= >
$strBB? i
,BBi j
exBBk m
.BBm n
ToStringBBn v
(BBv w
)BBw x
,BBx y
falseBBz 
)	BB Ä
;
BBÄ Å
}CC 	
}DD 
}EE È
LD:\GitProjects\BookMyShow\payment\imintsettlement\Properties\AssemblyInfo.cs
[ 
assembly 	
:	 

AssemblyTitle 
( 
$str *
)* +
]+ ,
[ 
assembly 	
:	 

AssemblyDescription 
( 
$str H
)H I
]I J
[ 
assembly 	
:	 
!
AssemblyConfiguration  
(  !
$str! #
)# $
]$ %
[ 
assembly 	
:	 

AssemblyCompany 
( 
$str <
)< =
]= >
[ 
assembly 	
:	 

AssemblyProduct 
( 
$str ,
), -
]- .
[		 
assembly		 	
:			 

AssemblyCopyright		 
(		 
$str		 J
)		J K
]		K L
[

 
assembly

 	
:

	 

AssemblyTrademark

 
(

 
$str

 
)

  
]

  !
[ 
assembly 	
:	 

AssemblyCulture 
( 
$str 
) 
] 
[ 
assembly 	
:	 


ComVisible 
( 
false 
) 
] 
[ 
assembly 	
:	 

Guid 
( 
$str 6
)6 7
]7 8
[ 
assembly 	
:	 

AssemblyFileVersion 
( 
$str +
)+ ,
], -